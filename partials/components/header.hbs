<header class="arcat-header">
    <div class="arcat-header-wrapper">
        <a class="arcat-logo-wrapper" href="{{@site.url}}">
            <img class="arcat-logo" src="{{asset "images/arcat-logo.svg"}}" alt="Arcat by" />
            <img class="arcat-logo-text" src="{{asset "images/catsissue-logo.png"}}" alt="Cats Isuue" />
        </a>
        {{#if @member}}
            <div class="arcat-nav-user">
                {{#if @member.paid}}
                    <a class="arcat-nav-user-avatar-placeholder" href="#/portal/account" data-portal="subscribe">
                        <img src="{{@member.avatar_image}}" alt="{{@member.name}}" class="arcat-nav-user-avatar">
                    </a>
                {{else}}
                    <a class="arcat-nav-user-avatar-placeholder" href="#/portal/account" data-portal="subscribe" data-member-name="{{@member.name}}">
                        <span class="arcat-nav-user-initial"></span>
                    </a>
                {{/if}}
                {{> "search-toggle"}}
            </div>
        {{else}}
            <div class="arcat-nav">
                <a class="arcat-login" href="#/portal/signin" data-portal="signin">ログイン</a>
                <a class="arcat-signup" href="#/portal/signup" data-portal="signup">新規登録</a>
            </div>
        {{/if}}
        <button class="arcat-menu-button" aria-label="メニュー">
            <div class="arcat-hamburger">
                {{> "icons/burger"}}
                {{> "icons/close"}}
            </div>
        </button>
    </div>
</header>
<div class="arcat-nav-overlay"></div>
<nav class="arcat-nav-menu">
    <div class="arcat-nav-menu-primary">
        {{navigation}}
        {{#if @member}}
            <a class="arcat-nav-menu-signout" href="javascript:" data-members-signout>ログアウト</a>
        {{/if}}
    </div>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize user avatar placeholders with first letter
        const avatarPlaceholders = document.querySelectorAll('.arcat-nav-user-avatar-placeholder');

        avatarPlaceholders.forEach(function(placeholder) {
            // Get the data-member-name attribute or fallback to text content
            const memberName = placeholder.getAttribute('data-member-name') || placeholder.textContent.trim();
            if (memberName) {
                // Get first letter and create or update the span
                const firstLetter = memberName.charAt(0).toUpperCase();
                let initialSpan = placeholder.querySelector('.arcat-nav-user-initial');
                if (!initialSpan) {
                    initialSpan = document.createElement('span');
                    initialSpan.className = 'arcat-nav-user-initial';
                    placeholder.appendChild(initialSpan);
                }

                initialSpan.textContent = firstLetter;
            }
        });

        // Toggle mobile menu
        const header = document.querySelector('.arcat-header');
        const menuButton = header?.querySelector('.arcat-menu-button');
        const navMenu = document.querySelector('.arcat-nav-menu');
        const navOverlay = document.querySelector('.arcat-nav-overlay');

        if (menuButton) {
            menuButton.addEventListener('click', function() {
                header.classList.toggle('is-open');
                navMenu.classList.toggle('is-open');
                navOverlay.classList.toggle('is-open');
                if (header.classList.contains('is-open')) {
                    document.documentElement.style.overflowY = 'hidden';
                } else {
                    document.documentElement.style.overflowY = null;
                }
            });
        }

        // Check membership status using {{@member}}
        const isLoggedIn = {{#if @member}}true{{else}}false{{/if}};

        // If not logged in, hide the .nav-contact link
        // (assuming there is a <li class="nav-contact"> inside <ul class="nav">)
        const navContact = document.querySelector('.arcat-nav-menu-primary ul.nav li.nav-contact');
        if (navContact && !isLoggedIn) {
            navContact.style.display = 'none';
        }
    });
</script>
