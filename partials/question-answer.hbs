{{^if @member}}
<aside class="gh-post-upgrade-cta">
	<div class="gh-post-upgrade-cta-content">
        <h2>ã“ã®å…ˆã¯éƒ¨å“¡é™å®š</h2>
        <a class="gh-post-upgrade-signup-link" href="#/portal/signup" data-portal="signup">
            {{t "ğŸ€å…¥éƒ¨ã™ã‚‹â›¹ï¸"}}
        </a>
	</div>
</aside>
{{/if}}

<div id="cove"></div>

<script>
const Cove = {
  contentId: "{{id}}",
  memberId: "{{@member.uuid}}",
  memberEmail: "{{@member.email}}",
  memberName: "{{@member.firstname}}"
};

const observer = new MutationObserver((mutationsList, observer) => {
  const form = document.getElementById('cove-form');
  console.log('form:', form);
  if (form) {

    const nameInput = document.getElementById('cove-input-name');

    if (nameInput) {
      const nameLabel = document.createElement('label');
      nameLabel.setAttribute('for', 'cove-input-name');
      nameLabel.textContent = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹';

      const nameGroup = document.createElement('div');
      nameGroup.classList.add('form-group');
      nameGroup.appendChild(nameLabel);
      nameGroup.appendChild(nameInput);

      form.insertBefore(nameGroup, form.firstChild);
    }

    const bodyInput = document.getElementById('cove-input-body');

    if (bodyInput) {
      const bodyLabel = document.createElement('label');
      bodyLabel.setAttribute('for', 'cove-input-body');
      bodyLabel.textContent = 'æ¸¡é‚Šé›„å¤ªã¸ã®è³ªå•';

      const bodyGroup = document.createElement('div');
      bodyGroup.classList.add('form-group');
      bodyGroup.appendChild(bodyLabel);
      bodyGroup.appendChild(bodyInput);

      const errorSpan = document.createElement('span');
      errorSpan.textContent = 'ãƒ†ã‚­ã‚¹ãƒˆã‚’140å­—ä»¥å†…ã«ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚';
      errorSpan.style.color = 'red';
      errorSpan.style.display = 'none';
      bodyGroup.appendChild(errorSpan);

      const note = document.createElement('p');
      note.textContent = 'â€»è³ªå•ã«ã¯æŠ½é¸ã§ä¸å®šæœŸã«æ¸¡é‚Šé›„å¤ªæœ¬äººãŒArticlesã®ä¸­ã§å›ç­”ã„ãŸã—ã¾ã™ã€‚';
      bodyGroup.appendChild(note);

      form.insertBefore(bodyGroup, form.querySelector('#cove-submit'));

      const submitButton = document.getElementById('cove-submit');
      submitButton.classList.add('disabled');
      submitButton.setAttribute('disabled', true);

      const checkInput = () => {
        const isBodyFilled = bodyInput.value.trim() !== '';
        const bodyValue = bodyInput.value;
        const isBodyWithinLimit = bodyValue.length <= 140;

        if (!isBodyWithinLimit) {
          errorSpan.style.display = 'block';
        } else {
          errorSpan.style.display = 'none';
        }

        const isNameFilled = nameInput ? nameInput.value.trim() !== '' : true;

        // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ•ã‚©ãƒ¼ãƒ ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€è³ªå•ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å…¥åŠ›çŠ¶æ…‹ã ã‘ã§ãƒã‚§ãƒƒã‚¯
        if (isNameFilled && isBodyFilled && isBodyWithinLimit) {
          submitButton.classList.remove('disabled');
          submitButton.removeAttribute('disabled');
        } else {
          submitButton.classList.add('disabled');
          submitButton.setAttribute('disabled', true);
        }
      };

      bodyInput.addEventListener('input', checkInput);
      if (nameInput) {
        nameInput.addEventListener('input', checkInput);
      }
    }

    observer.disconnect();
  }
});

observer.observe(document.body, { childList: true, subtree: true });
</script>