{{!< default}}
{{!-- The tag above means: insert everything in this file into the body of the default.hbs template --}}

{{#post}}

<main class="gh-main">

    <article class="gh-article {{post_class}}">
        {{> "feature-image"}}

        <header class="gh-article-header">

            <h1 class="gh-article-title is-title">{{title}}</h1>

            {{#if @custom.show_post_metadata}}
            <div class="gh-article-meta">
                <div class="gh-article-meta-wrapper">
                    <div class="gh-article-meta-content">
                        <time class="gh-article-meta-date" datetime="{{date format="YYYY.MM.DD"}}">date {{date format="YYYY.MM.DD"}}</time>
                    </div>
                </div>
            </div>
            {{/if}}

            {{#if tags}}
                <div class="gh-article-tags">
                    {{#foreach tags}}
                        <a class="gh-article-tag" href="{{url}}" data-slug="{{slug}}" style="display: none;">{{name}}</a>
                    {{/foreach}}
                </div>
            {{/if}}

        </header>

        <section class="gh-content gh-article-content is-body{{#if @custom.enable_drop_caps_on_posts}} drop-cap{{/if}}">
            {{content}}
            <div class="gh-post-author-link">
                <p>Authors:
                    {{#foreach authors}}
                        <a href="{{url}}"><span>{{name}}</span></a>{{#unless @last}}, {{/unless}}
                    {{/foreach}}
                </p>
            </div>
            {{post_like postId=id}}
        </section>

    </article>

    {{#if comments}}
        <div class="gh-comments gh-canvas">
            {{comments title="Comments" count=false}}
        </div>
    {{/if}}

</main>

{{/post}}

{{#if @custom.show_related_articles}}
    {{!-- 有料メンバーの場合 --}}
    {{#if @member.paid}}
        {{#get "posts" include="authors" filter="id:-{{post.id}}" limit="2" as |next|}}
            {{#if next}}
                <section class="recommend-container">
                    <div class="recommend-container-inner">
                        <h2 class="recommend-container-title">You may also like</h2>
                        <div class="recommend-feed">
                            {{#foreach posts}}
                                <article class="recommend-post-card">
                                    <a href="{{url}}">
                                        {{#if feature_image}}
                                            <img src="{{feature_image}}" alt="{{title}}">
                                        {{else}}
                                            <img src="{{asset "images/default_post_feature_img.png"}}" alt="{{title}}">
                                        {{/if}}
                                    </a>
                                    <h3 class="recommend-post-title">{{title}}</h3>
                                    <time class="recommend-post-date" datetime="{{date format="YYYY-MM-DD"}}">
                                        {{date format="YYYY.MM.DD"}}
                                    </time>
                                </article>
                            {{/foreach}}
                        </div>
                    </div>
                </section>
            {{/if}}
        {{/get}}
    {{!-- 無料メンバーの場合 --}}
    {{else}}
        <section class="recommend-container">
            <div class="recommend-container-inner">
                <h2 class="recommend-container-title">You may also like</h2>
                <div id="recommend-feed" class="recommend-feed">
                    {{!-- 無料記事を2件取得 --}}
                    {{#get "posts" filter="visibility:public+id:-{{post.id}}" limit="2" as |freePosts|}}
                        {{#foreach freePosts}}
                            <article class="recommend-post-card">
                                <a href="{{url}}">
                                    {{#if feature_image}}
                                        <img src="{{feature_image}}" alt="{{title}}">
                                    {{else}}
                                        <img src="{{asset "images/default_post_feature_img.png"}}" alt="{{title}}">
                                    {{/if}}
                                </a>
                                <h3 class="recommend-post-title">{{title}}</h3>
                                <time class="recommend-post-date" datetime="{{date format="YYYY-MM-DD"}}">
                                    {{date format="YYYY.MM.DD"}}
                                </time>
                            </article>
                        {{/foreach}}
                    {{/get}}

                    {{!-- 有料記事を2件取得 --}}
                    {{#get "posts" filter="visibility:paid+id:-{{post.id}}" limit="2" as |paidPosts|}}
                        {{#foreach paidPosts}}
                            <article class="recommend-post-card">
                                <a href="{{url}}">
                                    {{#if feature_image}}
                                        <img src="{{feature_image}}" alt="{{title}}">
                                    {{else}}
                                        <img src="{{asset "images/default_post_feature_img.png"}}" alt="{{title}}">
                                    {{/if}}
                                </a>
                                <h3 class="recommend-post-title">{{title}}</h3>
                                <time class="recommend-post-date" datetime="{{date format="YYYY-MM-DD"}}">
                                    {{date format="YYYY.MM.DD"}}
                                </time>
                            </article>
                        {{/foreach}}
                    {{/get}}
                </div>
            </div>
        </section>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const recommendFeed = document.getElementById('recommend-feed');
                const posts = recommendFeed.querySelectorAll('.recommend-post-card');

                // 3件目以降の投稿を非表示にする
                if (posts.length > 2) {
                    for (let i = 2; i < posts.length; i++) {
                        posts[i].style.display = 'none';
                    }
                }
            });
        </script>
    {{/if}}
{{/if}}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const tags = document.querySelectorAll('.gh-article-tag');

        tags.forEach(tag => {
            const slug = tag.getAttribute('data-slug');
            // slug が "free" でない場合、タグを表示
            if (slug !== "free") {
                tag.style.display = "inline-block";
            }
        });
    });
</script>